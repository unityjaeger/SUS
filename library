local lib = {
    waitstyle = "RenderStepped";
    fps = 0;
}

local toblock = {}
local funcs = {}

local OldNameCall
OldNameCall = hookmetamethod(game, "__namecall", function(Self, ...)
    local Args = {...}
    local NamecallMethod = getnamecallmethod()

    if not checkcaller() and (NamecallMethod == "FireServer" or NamecallMethod == "InvokeServer") then
        if table.find(toblock, Self) then
            return
        end
    end

    return OldNameCall(Self, ...)
end)

game:GetService("RunService").RenderStepped:Connect(function(delta)
    lib.fps = 1/delta

    if lib.fps <= 50 then
        lib.waitstyle = "Heartbeat"
    else
        lib.waitstyle = "RenderStepped"
    end
    
    for _, Function in pairs(funcs) do
        Function()
    end
end)

function lib:GUIDName(name)
    return name.."_"..game:GetService("HTTPService"):GenerateGUID(true)
end

function lib:AddToRender(name, func)
    funcs[name] = func
end

function lib:RemoveFromRender(name)
    if funcs[name] then
        funcs[name]:Disconnect()
        funcs[name] = nil
    end
end

function lib:DictSize(dictionary, element)
    local n = 0
    for k,_ in pairs(dictionary) do
        if element then
            if k == element then
                n = n + 1
            end
        else
            n = n + 1
        end
    end
    return n
end

function lib:Player()
    return game:GetService("Players").LocalPlayer or nil
end

function lib:Character(var)
    if lib:Player() and lib:Player().Character then
        if var then
            return lib:Player().Character:FindFirstChild(var) or nil
        else
            return lib:Player().Character
        end
    end
end

function lib:Humanoid(alive, OnExist)
    local hum = lib:Character("Humanoid")
    if not hum then return false end

    if not alive then
        if OnExist then
            OnExist()
        end
    else
        if hum.Health > 0 then
            if OnExist then
                OnExist()
            end
        end
    end

    return hum
end

function lib:Root(OnExist)
    local humrp = lib:Character("HumanoidRootPart")
    if not humrp then return false end

    if OnExist then
        OnExist()
    end
    return humrp
end

function lib:TP(cframe)
    lib:Root(function()
        lib:Root().CFrame = cframe
    end)
end

function lib:Tween(cframe, speed)
    local root = lib:Root()
    lib:Root(function()
        local tweenspeed = (root.Position - cframe.Position).magnitude / speed
        game:GetService("TweenService"):Create(root, TweenInfo.new(tweenspeed, Enum.EasingStyle.Linear), {CFrame = cframe}):Play()
    end)
end

function lib:BlockRemote(remote)
    if not table.find(toblock, remote) then
        table.insert(toblock, remote)
    end
end

function lib:UnblockRemote(remote)
    if table.find(toblock, remote) then
        table.remove(toblock, table.find(toblock, remote))
    end
end

function lib:WaitFor(parent, var, timeout, OnExist)
    local stopat = os.clock() + (timeout or 30)

    while not parent:FindFirstChild(var) do
        if os.clock() >= stopat then
            break
        end

        game:GetService("RunService")[lib.waitstyle]:Wait()
    end

    if parent:FindFirstChild(var) then
        return parent[var]
    else
        return nil
    end
end

function lib:Wait(time)
    local stopat = os.clock() + (time or 0)
    while os.clock() < stopat do
        game:GetService("RunService")[lib.waitstyle]:Wait()
    end
end

return lib
